<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.116.0-DEV">
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Instance Config Reference :: gokrazy</title>

    
    <link href="/css/nucleus.css?1721548409" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1721548409" rel="stylesheet">
    <link href="/css/hybrid.css?1721548409" rel="stylesheet">
    <link href="/css/featherlight.min.css?1721548409" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1721548409" rel="stylesheet">
    <link href="/css/auto-complete.css?1721548409" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1721548409" rel="stylesheet">
    <link href="/css/theme.css?1721548409" rel="stylesheet">
    <link href="/css/tabs.css?1721548409" rel="stylesheet">
    <link href="/css/hugo-theme.css?1721548409" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1721548409"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/userguide/instance-config/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <img src="/logo.svg" width="100%" alt="gokrazy logo" title="gokrazy logo">

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1721548409"></script>
<script type="text/javascript" src="/js/auto-complete.js?1721548409"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/gokrazy.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1721548409"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/quickstart/" title="Quickstart" class="dd-item
        
        
        
        ">
      <a href="/quickstart/">
          <b>1. </b>Quickstart
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/platforms/" title="Supported platforms" class="dd-item
        
        
        
        ">
      <a href="/platforms/">
          <b>2. </b>Supported platforms
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/userguide/" title="Configuration" class="dd-item
        parent
        
        
        ">
      <a href="/userguide/">
          <b>3. </b>Configuration
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/userguide/instance-config/" title="Instance Config Reference" class="dd-item active">
        <a href="/userguide/instance-config/">
        Instance Config Reference
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/migration-guide/" title="Instance Config Migration Guide" class="dd-item ">
        <a href="/userguide/migration-guide/">
        Instance Config Migration Guide
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/automation/" title="Automation" class="dd-item ">
        <a href="/userguide/automation/">
        Automation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/package-config/" title="Package config: flags, environment variables, extra files" class="dd-item ">
        <a href="/userguide/package-config/">
        Flags, environment variables, …
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/remotesyslog/" title="Remote Syslog: sending gokrazy logs over the network" class="dd-item ">
        <a href="/userguide/remotesyslog/">
        Remote Syslog
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/wifi/" title="Connecting to WiFi networks" class="dd-item ">
        <a href="/userguide/wifi/">
        Connecting to WiFi
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/tls-for-untrusted-networks/" title="Using TLS in untrusted networks" class="dd-item ">
        <a href="/userguide/tls-for-untrusted-networks/">
        Using TLS in untrusted networks
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/bluetooth/" title="Using Bluetooth" class="dd-item ">
        <a href="/userguide/bluetooth/">
        Using Bluetooth
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/permanent-data/" title="Access permanent data" class="dd-item ">
        <a href="/userguide/permanent-data/">
        Access permanent data
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/qemu/" title="QEMU x86-64 virtual machine" class="dd-item ">
        <a href="/userguide/qemu/">
        QEMU x86-64 virtual machine
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/rsync-backups/" title="Permanent data backup with the gokrazy rsyncd" class="dd-item ">
        <a href="/userguide/rsync-backups/">
        Data backup with rsync
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/packages/" title="Available packages" class="dd-item
        
        
        
        ">
      <a href="/packages/">
          <b>4. </b>Available packages
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/packages/showcase/" title="Showcase" class="dd-item ">
        <a href="/packages/showcase/">
        Showcase
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/packages/tailscale/" title="Tailscale VPN" class="dd-item ">
        <a href="/packages/tailscale/">
        Tailscale VPN
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/packages/caddy-http-server/" title="Caddy HTTP server" class="dd-item ">
        <a href="/packages/caddy-http-server/">
        Caddy HTTP server
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/packages/minio/" title="MinIO object storage" class="dd-item ">
        <a href="/packages/minio/">
        MinIO object storage
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/packages/docker-containers/" title="Docker containers" class="dd-item ">
        <a href="/packages/docker-containers/">
        Docker containers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/packages/prometheus/" title="Prometheus" class="dd-item ">
        <a href="/packages/prometheus/">
        Prometheus
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/development/" title="Package development" class="dd-item
        
        
        
        ">
      <a href="/development/">
          <b>5. </b>Package development
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/development/process-interface/" title="Process interface / requirements" class="dd-item ">
        <a href="/development/process-interface/">
        Process interface / requirements
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/development/gpio/" title="Controlling a GPIO input/output pin" class="dd-item ">
        <a href="/development/gpio/">
        Input/output via GPIO pins
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/development/modules/" title="Working with Go modules" class="dd-item ">
        <a href="/development/modules/">
        Working with Go modules
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/development/buildtags/" title="The gokrazy Go build tag" class="dd-item ">
        <a href="/development/buildtags/">
        The gokrazy Go build tag
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/development/non-go/" title="Non-Go Prototyping" class="dd-item ">
        <a href="/development/non-go/">
        Non-Go Prototyping
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://github.com/gokrazy/gokrazy"><i class='fab fa-github'></i> GitHub repo</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/gokrazy/gokrazy/tree/master/website/content/userguide/instance-config.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>gokrazy Go appliances</a> > <a href='/userguide/'>Configuration</a> > Instance Config Reference
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#hostname">Hostname</a></li>
    <li><a href="#devicetype">DeviceType</a></li>
    <li><a href="#packages">Packages</a></li>
    <li><a href="#packageconfig">PackageConfig</a>
      <ul>
        <li><a href="#packagegobuildflags">PackageConfig → GoBuildFlags</a></li>
        <li><a href="#packagegobuildtags">PackageConfig → GoBuildTags</a></li>
        <li><a href="#packageenvironment">PackageConfig → Environment</a></li>
        <li><a href="#packagecommandlineflags">PackageConfig → CommandLineFlags</a></li>
        <li><a href="#packagedontstart">PackageConfig → DontStart</a></li>
        <li><a href="#packagewaitforclock">PackageConfig → WaitForClock</a></li>
        <li><a href="#packageextrafilecontents">PackageConfig → ExtraFileContents</a></li>
        <li><a href="#packageextrafilepaths">PackageConfig → ExtraFilePaths</a></li>
      </ul>
    </li>
    <li><a href="#serialconsole">SerialConsole</a></li>
    <li><a href="#gokrazypackages">GokrazyPackages</a></li>
    <li><a href="#kernelpackage">KernelPackage</a></li>
    <li><a href="#firmwarepackage">FirmwarePackage</a></li>
    <li><a href="#eeprompackage">EEPROMPackage</a></li>
    <li><a href="#bootloader">Bootloader configuration</a></li>
    <li><a href="#mountconfig">Device mount configuration</a>
      <ul>
        <li><a href="#mountconfigsource">Device mount configuration → Source</a></li>
        <li><a href="#mountconfigtype">Device mount configuration → Type</a></li>
        <li><a href="#mountconfigtarget">Device mount configuration → Target</a></li>
        <li><a href="#mountconfigoptions">Device mount configuration → Options</a></li>
      </ul>
    </li>
    <li><a href="#update">Update</a>
      <ul>
        <li><a href="#updatehostname">Update → Hostname</a></li>
        <li><a href="#updateusetls">Update → UseTLS</a></li>
        <li><a href="#updatehttpport">Update → HTTPPort</a></li>
        <li><a href="#updatehttpsport">Update → HTTPSPort</a></li>
        <li><a href="#updatehttppassword">Update → HTTPPassword</a></li>
        <li><a href="#updatecertpem">Update → CertPEM</a></li>
        <li><a href="#updatekeypem">Update → KeyPEM</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Instance Config Reference
            </h1>
          

        


<p>Each gokrazy instance has a <code>config.json</code> file that contains the instance
configuration.</p>
<p>You can open the instance config in your editor by running <code>gok edit</code>:</p>
<ul>
<li><code>gok edit</code> will open the config of the default instance, which is named “hello”.</li>
<li><code>gok -i scanner edit</code> will open the config of instance “scanner”.</li>
</ul>
<p>If you prefer, you can also locate and edit the file directly on disk:
<code>~/gokrazy/hello/config.json</code></p>
<p>This document is a reference, explaining all configuration fields. You don’t
need to read through it all before you first start using gokrazy — follow the
other configuration guides in this section instead. In case anything should be
unclear, you can look at <a href="https://github.com/gokrazy/internal/blob/main/config/config.go">the <code>config.go</code> source
code</a> (and send
feedback, please!).</p>
<p>Older versions of gokrazy only used command-line flags and plain-text config
files instead of a central instance configuration. See the design document
<a href="https://docs.google.com/document/d/1AUDmc8lygLR59O29Oc4ckv-Buk2R9zrvPDO9JbPOts8/edit?usp=sharing">gokrazy “instance-centric” config
re-design</a>
for details on why the change was made, how old setups are kept working and how
they can be migrated.</p>
<p>Here is a minimal instance configuration example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;hello&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Most instance configuration files will be more complicated, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;ts&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tailscale.com/cmd/tailscaled&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tailscale.com/cmd/tailscale&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/mkfs&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/stapelberg/dr&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;PackageConfig&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tailscale.com/cmd/tailscale&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;CommandLineFlags&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;up&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tailscale.com/cmd/tailscaled&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;CommandLineFlags&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;--outbound-http-proxy-listen=localhost:9080&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;github.com/stapelberg/dr&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;Environment&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;HTTPS_PROXY=localhost:9080&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;HTTP_PROXY=localhost:9080&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="hostname">Hostname</h2>
<p>(Corresponds to the former <code>-hostname</code> gokr-packer flag.)</p>
<p>The <code>Hostname</code> field sets the <a href="https://en.wikipedia.org/wiki/Hostname">hostname</a>
of your gokrazy instance.</p>
<p>The gokrazy
<a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCP</a> client
sends this hostname when acquiring a lease, so if hostname resolution is working
in your local network, you will be able to access the device in your browser by
entering the hostname, e.g. <code>http://hello/</code> (username <code>gokrazy</code>, password as
configured in <a href="#updatehttppassword"><code>HTTPPassword</code></a> or
<code>~/.config/gokrazy/http-password.txt</code>).</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;example&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="devicetype">DeviceType</h2>
<p>(Corresponds to the former <code>-device_type</code> gokr-packer flag.)</p>
<p>The <code>DeviceType</code> field specifies which kind of target device this gokrazy
instance should be built for.</p>
<ul>
<li>
<p>empty (&quot;&quot;): target the Raspberry Pi (default) or UEFI/BIOS PCs (<a href="https://github.com/rtr7/kernel">router7
kernel</a>), depending on the
<a href="#kernelpackage"><code>KernelPackage</code></a> and <a href="#firmwarepackage"><code>FirmwarePackage</code></a>
you specify.</p>
</li>
<li>
<p><code>odroidhc1</code>: target the Odroid XU4/HC1/HC2 devices. This results in an MBR
without a GPT (as the Odroid devices do not support GPT), and in extra
bootloader files in the root partition.</p>
</li>
<li>
<p><code>rock64</code>: target Pine64 Rock64 devices.</p>
</li>
</ul>
<p>The possible values are defined in
<a href="https://github.com/gokrazy/internal/blob/main/deviceconfig/config.go"><code>github.com/gokrazy/internal/deviceconfig</code> (→ config.go)</a></p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;alternative&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;DeviceType&#34;</span>: <span style="color:#e6db74">&#34;odroidhc1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="packages">Packages</h2>
<p>(Corresponds to the former gokr-packer command line arguments.)</p>
<p>The <code>Packages</code> field lists the Go packages that should be built and included in
your gokrazy instance.</p>
<p>Each listed package is a <a href="https://go.dev/doc/code#Organization">Go import path</a>
referencing an executable Go program (<code>package main</code>).</p>
<p>To add a package to a gokrazy instance, use the <code>gok add</code> command, which also
works for packages that have not yet been published and are stored on your local
disk.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;hello&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;github.com/stapelberg/scan2drive/cmd/scan2drive&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="packageconfig">PackageConfig</h2>
<p>The <code>PackageConfig</code> field specifies how each package listed in <code>Packages</code> will
be built into your instance, and how it will be started at runtime.</p>
<p><code>PackageConfig</code> is a map that is keyed by the package Go import path.</p>
<p>See also the <a href="/userguide/package-config/">Package Config</a> page.</p>
<h3 id="packagegobuildflags">PackageConfig → GoBuildFlags</h3>
<p>(Corresponds to the former <code>buildflags</code> per-package directory text files.)</p>
<p>The <code>GoBuildFlags</code> field configures extra arguments that the <code>gok</code> CLI passes to
<code>go build</code> when building your <a href="#packages"><code>Packages</code></a>. See <a href="https://pkg.go.dev/cmd/go#hdr-Compile_packages_and_dependencies">the <code>cmd/go</code>
documentation</a>
for available flags.</p>
<p>To pass build tags, do not use <code>-tags=mycustomtag</code>, as that will overwrite
gokrazy’s own build tags. Instead, set the <a href="#packagegobuildtags"><code>GoBuildTags</code></a>
field.</p>
<p>Note that no shell escaping or quoting (with single or double quotes) is
required. The build flags are passed when calling <code>go build</code> via <a href="https://en.wikipedia.org/wiki/Exec_(system_call)">the <code>exec</code>
system call</a>.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;scanner&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/stapelberg/scan2drive/cmd/scan2drive&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;PackageConfig&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;github.com/stapelberg/scan2drive/cmd/scan2drive&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>            <span style="color:#f92672">&#34;GoBuildFlags&#34;</span>: [
</span></span><span style="display:flex; background-color:#3c3d38"><span>                <span style="color:#e6db74">&#34;-ldflags=-linkmode external -extldflags -static&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>            ]
</span></span><span style="display:flex; background-color:#3c3d38"><span>        }
</span></span><span style="display:flex; background-color:#3c3d38"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="packagegobuildtags">PackageConfig → GoBuildTags</h3>
<p>(Corresponds to the former <code>buildtags</code> per-package directory text files.)</p>
<p>The <code>GoBuildTags</code> field configures additional <a href="https://pkg.go.dev/cmd/go#hdr-Build_constraints">Go build
tags</a> (also known as build
constraints) to use when building your program.</p>
<p>Note: Some Go packages use build tags to optionally build code which uses
<a href="https://go.dev/blog/cgo">cgo</a>. Because gokrazy intentionally does not include a
C runtime environment, configuring such build tags results either in compilation
failures, or in programs that compile but won’t start. But, for certain specific
use-cases (<code>scan2drive</code>’s turbojpeg support, for example), you can enable just
enough cgo to end up with a fully statically linked program, which does work on
gokrazy.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;scanner&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/stapelberg/scan2drive/cmd/scan2drive&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;PackageConfig&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;github.com/stapelberg/scan2drive/cmd/scan2drive&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>            <span style="color:#f92672">&#34;GoBuildTags&#34;</span>: [
</span></span><span style="display:flex; background-color:#3c3d38"><span>                <span style="color:#e6db74">&#34;turbojpeg&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>            ]
</span></span><span style="display:flex; background-color:#3c3d38"><span>        }
</span></span><span style="display:flex; background-color:#3c3d38"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="packageenvironment">PackageConfig → Environment</h3>
<p>(Corresponds to the former <code>env</code> per-package directory text files.)</p>
<p>The <code>Environment</code> field configures <a href="https://en.wikipedia.org/wiki/Environment_variable">environment
variables</a> that will be set
when starting your program.</p>
<p>Each entry is a <code>key=value</code> pair, like in Go’s
<a href="https://pkg.go.dev/os#Environ"><code>os.Environ()</code></a>.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;ts&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/stapelberg/dr&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;PackageConfig&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;github.com/stapelberg/dr&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>            <span style="color:#f92672">&#34;Environment&#34;</span>: [
</span></span><span style="display:flex; background-color:#3c3d38"><span>                <span style="color:#e6db74">&#34;HTTPS_PROXY=localhost:9080&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>                <span style="color:#e6db74">&#34;HTTP_PROXY=localhost:9080&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>            ]
</span></span><span style="display:flex; background-color:#3c3d38"><span>        }
</span></span><span style="display:flex; background-color:#3c3d38"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="packagecommandlineflags">PackageConfig → CommandLineFlags</h3>
<p>(Corresponds to the former <code>flags</code> per-package directory text files.)</p>
<p>The <code>CommandLineFlags</code> field configures <a href="https://en.wikipedia.org/wiki/Command-line_interface#Arguments">command line
flags</a> that will
be set when starting your program.</p>
<p>Note that no shell escaping or quoting (with single or double quotes) is
required. The command line flags are passed when starting your program via <a href="https://en.wikipedia.org/wiki/Exec_(system_call)">the
<code>exec</code> system call</a>.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;ts&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tailscale.com/cmd/tailscaled&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;PackageConfig&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;tailscale.com/cmd/tailscaled&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>            <span style="color:#f92672">&#34;CommandLineFlags&#34;</span>: [
</span></span><span style="display:flex; background-color:#3c3d38"><span>                <span style="color:#e6db74">&#34;--port=41641&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>                <span style="color:#e6db74">&#34;--outbound-http-proxy-listen=localhost:9080&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>            ]
</span></span><span style="display:flex; background-color:#3c3d38"><span>        }
</span></span><span style="display:flex; background-color:#3c3d38"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="packagedontstart">PackageConfig → DontStart</h3>
<p>(Corresponds to the former <code>dontstart</code> per-package directory text files.)</p>
<p>Enabling the <code>DontStart</code> field makes the gokrazy init system not start your
program automatically.</p>
<p>You can still start the program manually via the web interface, or interactively
via <code>breakglass</code>.</p>
<p>This is useful for programs that are interactive command line tools, instead of
permanently running services.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;ts&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tailscale.com/cmd/tailscaled&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tailscale.com/cmd/tailscale&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;PackageConfig&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;tailscale.com/cmd/tailscale&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>            <span style="color:#f92672">&#34;DontStart&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>        }
</span></span><span style="display:flex; background-color:#3c3d38"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="packagewaitforclock">PackageConfig → WaitForClock</h3>
<p>(Corresponds to the former <code>waitforclock</code> per-package directory text files.)</p>
<p>The <code>WaitForClock</code> field makes the gokrazy init system wait for clock
synchronization before starting the program. This is useful when modifying the
program source to call
<a href="https://pkg.go.dev/github.com/gokrazy/gokrazy#WaitForClock"><code>gokrazy.WaitForClock()</code></a>
is inconvenient.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;scanner&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/stapelberg/scan2drive/cmd/scan2drive&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;PackageConfig&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;github.com/stapelberg/scan2drive/cmd/scan2drive&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>            <span style="color:#f92672">&#34;WaitForClock&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>        }
</span></span><span style="display:flex; background-color:#3c3d38"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="packageextrafilecontents">PackageConfig → ExtraFileContents</h3>
<p>(Corresponds to the former <code>extrafiles</code> per-package directory text files.)</p>
<p>The <code>ExtraFileContents</code> field allows adding extra files into the root file
system of your gokrazy instance. Any file aside from the built Go program
(e.g. <code>scan2drive</code>) is considered extra.</p>
<p><code>ExtraFileContents</code> is a map from root file system destination path
(e.g. <code>/etc/caddy/Caddyfile</code>) to the plain text contents of the extra file.</p>
<p>The extra file will be created as a regular file (not executable) with default
permissions (UNIX mode <code>644</code>, or <code>-rw-r--r--</code>). Note that gokrazy’s root file
system is read-only.</p>
<p>It can be more convenient to manage extra files as standalone, separate files
(not as part of <code>config.json</code>), which the
<a href="#packageextrafilepaths"><code>ExtraFilePaths</code></a> field allows you to do.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;webserver&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/caddyserver/caddy/v2/cmd/caddy&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;PackageConfig&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;github.com/caddyserver/caddy/v2/cmd/caddy&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>            <span style="color:#f92672">&#34;ExtraFileContents&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>                <span style="color:#f92672">&#34;/etc/caddy/Caddyfile&#34;</span>: <span style="color:#e6db74">&#34;http://:8080 {
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">	root * /tmp
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">	file_server browse
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>            }
</span></span><span style="display:flex; background-color:#3c3d38"><span>        }
</span></span><span style="display:flex; background-color:#3c3d38"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="packageextrafilepaths">PackageConfig → ExtraFilePaths</h3>
<p>(Corresponds to the former <code>extrafiles</code> per-package directory text files.)</p>
<p>The <code>ExtraFilePaths</code> field allows adding extra files into the root file
system of your gokrazy instance. Any file aside from the built Go program
(e.g. <code>scan2drive</code>) is considered extra.</p>
<p><code>ExtraFilePaths</code> is a map from root file system destination path
(e.g. <code>/etc/caddy/Caddyfile</code>) to a relative or absolute path of the extra files
to include. Relative paths are relative to the instance directory,
e.g. <code>~/gokrazy/hello</code> — the same directory in which <code>config.json</code> lives.</p>
<p>The extra file path can refer to one of:</p>
<ul>
<li>a regular file. File modes are retained, including the executable bit.</li>
<li>a directory. All files and directories within the directory are recursively
included.</li>
<li>a <a href="https://en.wikipedia.org/wiki/Tar_(computing)">.tar archive</a>:
<code>&lt;path&gt;.tar</code>. All files contained in the archive are included.</li>
<li>an architecture-dependent .tar file: <code>&lt;path&gt;_&lt;target_goarch&gt;.tar</code>, for example
<code>firmware_amd64.tar</code></li>
</ul>
<p>Go packages that target gokrazy can optionally include a <code>_gokrazy</code> directory,
in which gokrazy will look for extrafiles. Conceptually, the directory is
handled as if you had configured <code>ExtraFilePaths: &quot;/home/michael/go/src/github.com/gokrazy/wifi/_gokrazy/extrafiles&quot;</code>.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;webserver&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/caddyserver/caddy/v2/cmd/caddy&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;PackageConfig&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;github.com/caddyserver/caddy/v2/cmd/caddy&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>            <span style="color:#f92672">&#34;ExtraFilePaths&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>                <span style="color:#f92672">&#34;/etc/caddy/Caddyfile&#34;</span>: <span style="color:#e6db74">&#34;Caddyfile&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>            }
</span></span><span style="display:flex; background-color:#3c3d38"><span>        }
</span></span><span style="display:flex; background-color:#3c3d38"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat &gt; ~/gokrazy/webserver/Caddyfile <span style="color:#e6db74">&lt;&lt;&#39;EOT&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http://:80 {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	root * /tmp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">	file_server browse 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOT</span>
</span></span></code></pre></div><h2 id="serialconsole">SerialConsole</h2>
<p>(Corresponds to the former <code>-serial_console</code> gokr-packer flag.)</p>
<p>The <code>SerialConsole</code> field controls whether the Linux kernel provides a serial
console on the Raspberry Pi’s UART0 RX/TX ports (see
<a href="https://pinout.xyz">pinout.xyz</a>). To use this serial console, a popular option
is to connect a USB-to-serial adapter.</p>
<p>Linux supports multiple consoles, but only one can be the default
console. Kernel messages during boot will be printed to the default
console. When you turn off the serial console, the default console will be shown
on the HDMI output, and accept input from the USB keyboard.</p>
<p>The advantage of using a serial console is that you can easily save the entire
boot output to a file on a separate computer (whereas with an HDMI console, text
scrolls by very fast), and you can get debug output from the Raspberry Pi
bootloader as well for debugging.</p>
<ul>
<li><code>serial0,115200</code> (default if unset) enables UART0 as a serial console with
115200 baud. This value is used as <code>console=</code> Linux kernel parameter, so use
values like <code>ttyS0,115200</code> if you want to use a different serial port for your
console, e.g. when running gokrazy on a PC.</li>
<li><code>disabled</code> will disable the serial console (the default console will be HDMI),
which frees up the serial port for usage by your applications.</li>
<li><code>off</code> sets <code>enable_uart=0</code> in <code>config.txt</code> for the Raspberry Pi firmware,
which will save a little bit of power by running the Pi at lower clock speeds.</li>
</ul>
<p>If you want to write an application that uses the serial port, open
<code>/dev/serial0</code>
(<a href="https://github.com/stapelberg/hmgo/blob/4c33c14a7c1e2e2baeccd53f281e440c4653d67b/ccu.go#L92">example</a>),
which is a symlink that points to the device handling the RX/TX pins (typically
<code>ttyAMA0</code> or <code>ttyS0</code>).</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;router7&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;SerialConsole&#34;</span>: <span style="color:#e6db74">&#34;ttyS0,115200&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="gokrazypackages">GokrazyPackages</h2>
<p>(Corresponds to the former <code>-gokrazy_pkgs</code> gokr-packer flag.)</p>
<p>Aside from the user-specified <a href="#packages"><code>Packages</code></a>, a gokrazy instance also
includes a couple of packages that are considered part of the system, because
they are needed to boot the system into a useful state. These are placed in the
<code>/gokrazy</code> directory (other packages are placed in the <code>/user</code> directory).</p>
<p>If unset, the following packages will be included by default:</p>
<ul>
<li><code>github.com/gokrazy/gokrazy/cmd/dhcp</code> sets the IP address after obtaining a
<a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCPv4</a>
lease.</li>
<li><code>github.com/gokrazy/gokrazy/cmd/ntp</code> synchronizes the hardware clock via
<a href="https://en.wikipedia.org/wiki/Network_Time_Protocol">NTP</a>.</li>
<li><code>github.com/gokrazy/gokrazy/cmd/randomd</code> stores/loads a kernel <a href="https://en.wikipedia.org/wiki/Random_seed">random
seed</a> across boots.</li>
</ul>
<p>Typically you don’t need to configure this field, but it can be useful to
overwrite the <code>GokrazyPackages</code> if some component clashes with how you want to
use your device. For example, for <a href="https://router7.org">router7</a>, I need to
remove the gokrazy <code>dhcp</code> package as router7 has its own DHCP client. Or, if you
were building a local NTP server, you might want to remove the gokrazy <code>ntp</code>
package.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;router7&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;GokrazyPackages&#34;</span>: [
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/gokrazy/cmd/ntp&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/gokrazy/cmd/randomd&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="kernelpackage">KernelPackage</h2>
<p>(Corresponds to the former <code>-kernel_package</code> gokr-packer flag.)</p>
<p>The <code>KernelPackage</code> field specifies a Go import path that references a package
which does not contain any Go code, but instead contains a Linux kernel image
(<code>vmlinuz</code>).</p>
<p>The following files are taken from the kernel package directory and are included
in the boot file system of your gokrazy instance:</p>
<ul>
<li><code>vmlinuz</code>, a compiled Linux kernel image</li>
<li><code>*.dtb</code>, <a href="https://en.wikipedia.org/wiki/Devicetree">Linux device tree</a> files</li>
<li><code>boot.scr</code>, <a href="https://en.wikipedia.org/wiki/Das_U-Boot">U-Boot script</a></li>
</ul>
<p>Additionally, the <code>lib/modules</code> subdirectory (containing loadable Linux kernel
modules) is included in the root file system. Note that these modules are only
included, but not automatically loaded (there is no <code>udev</code> or equivalent on
gokrazy). If you need to load modules for your hardware, see
<a href="https://github.com/gokrazy/bluetooth/blob/main/bluetooth.go"><code>bluetooth.go</code></a>
for an example program that loads kernel modules.</p>
<p>Default if unset: <code>github.com/gokrazy/kernel</code></p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;router7&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;KernelPackage&#34;</span>: <span style="color:#e6db74">&#34;github.com/rtr7/kernel&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="firmwarepackage">FirmwarePackage</h2>
<p>(Corresponds to the former <code>-firmware_package</code> gokr-packer flag.)</p>
<p>The <code>FirmwarePackage</code> field specifies a Go import path that references a package
which does not contain any Go code, but instead contains Raspberry Pi firmware
files.</p>
<p>The following files are taken from the firmware package directory and are
included in the boot file system of your gokrazy instance:</p>
<ul>
<li><code>*.bin</code>, Raspberry Pi firmware files</li>
<li><code>*.dat</code>, Raspberry Pi firmware files</li>
<li><code>*.elf</code>, Raspberry Pi firmware files</li>
<li><code>*.upd</code>, Raspberry Pi EEPROM update files</li>
<li><code>*.sig</code>, Raspberry Pi EEPROM update signatures</li>
<li><code>overlays/*.dtbo</code>, Device Tree overlay files for the Raspberry Pi OS kernel</li>
</ul>
<p>Default if unset: <code>github.com/gokrazy/firmware</code></p>
<p>If empty, no files will be included.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;router7&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;FirmwarePackage&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="eeprompackage">EEPROMPackage</h2>
<p>(Corresponds to the former <code>-eeprom_package</code> gokr-packer flag.)</p>
<p>The <code>EEPROMPackage</code> field specifies a Go import path that references a package
which does not contain any Go code, but instead contains Raspberry Pi EEPROM
update files.</p>
<p>The following files are taken from the firmware package directory and are
included in the boot file system of your gokrazy instance:</p>
<ul>
<li><code>pieeprom-*.bin</code>, Raspberry Pi EEPROM update files</li>
<li><code>recovery.bin</code>, Raspberry Pi EEPROM update files</li>
<li><code>lv805-*.bin</code>, Raspberry Pi EEPROM update files</li>
</ul>
<p>Default if unset: <code>github.com/gokrazy/rpi-eeprom</code></p>
<p>If empty, no files will be included.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;router7&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;EEPROMPackage&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="bootloader">Bootloader configuration</h2>
<p>The Raspberry Pi’s “system configuration parameters” (interpreted by the
bootloader, or “boot firmware”) can be configured via <a href="https://www.raspberrypi.com/documentation/computers/config_txt.html">the <code>config.txt</code>
file</a> on
the boot file system.</p>
<p>The <code>BootloaderExtraLines</code> array contains one string per extra line that should
be added to <code>config.txt</code> when the gokrazy packer creates the boot file system.</p>
<p>This allows enabling the <a href="https://www.raspberrypi.com/documentation/computers/configuration.html#part3.1">Raspberry Pi-provided Device Tree
Overlays</a>
— the example below enables <a href="https://en.wikipedia.org/wiki/1-Wire">1-Wire</a>
support. Note that not all Device Tree Overlays are guaranteed to work;
compatibility depends on whether the upstream Linux driver matches the Raspberry
Pi OS Linux driver.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;hello&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;BootloaderExtraLines&#34;</span>: [
</span></span><span style="display:flex; background-color:#3c3d38"><span>	    <span style="color:#e6db74">&#34;dtoverlay=w1-gpio&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>	]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h2 id="mountconfig">Device mount configuration</h2>
<p>gokrazy allows specifying additional devices that will be mounted under <code>/mnt</code>
when a gokrazy instance boots. The <code>gok</code> CLI will create the directory in the
root file system, the gokrazy init system will (repeatedly, indefinitely) try to
find the device specified by <code>Source</code> and mount it at <code>Target</code>.</p>
<p>This allows you to make use of e.g. an external SSD as fast and reliable storage.</p>
<h3 id="mountconfigsource">Device mount configuration → Source</h3>
<p>Currently, the following formats are supported:</p>
<ul>
<li><code>PARTUUID=</code>, where you identify a partition by its GPT partition UUID (print with <a href="https://manpages.debian.org/blkid.8">blkid(8)</a>)</li>
<li><code>UUID=</code>, where you identify an ext2, ext3 or ext4 file system by its UUID (print with <a href="https://manpages.debian.org/blkid.8">blkid(8)</a>)</li>
<li><code>/dev/sda4</code>, where you provide the (hopefully stable) path of a device node directly</li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;hello&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;MountDevices&#34;</span>: [
</span></span><span style="display:flex; background-color:#3c3d38"><span>		{
</span></span><span style="display:flex; background-color:#3c3d38"><span>		    <span style="color:#f92672">&#34;Source&#34;</span>: <span style="color:#e6db74">&#34;PARTUUID=c995c848-1d29-4f08-a34d-cd811e84a763&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>		    <span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;ext4&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>		    <span style="color:#f92672">&#34;Target&#34;</span>: <span style="color:#e6db74">&#34;/mnt/usb-thumb-drive&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>		    <span style="color:#f92672">&#34;Options&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>		}
</span></span><span style="display:flex; background-color:#3c3d38"><span>	]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="mountconfigtype">Device mount configuration → Type</h3>
<p>The <code>Type</code> field specifies the file system type to mount. Typically <code>ext4</code>, or
any other file system your kernel supports. You can use <code>cat /proc/filesystems</code>
in a <a href="https://github.com/gokrazy/breakglass/">breakglass</a> shell to list them.</p>
<h3 id="mountconfigtarget">Device mount configuration → Target</h3>
<p>File system path under <code>/mnt</code> in which to mount the device, e.g. <code>/mnt/usb-thumb-drive</code></p>
<h3 id="mountconfigoptions">Device mount configuration → Options</h3>
<p>gokrazy supports the usual <a href="https://manpages.debian.org/mount.8#FILESYSTEM-INDEPENDENT_MOUNT_OPTIONS">filesystem-independent mount
options</a>
like <code>ro</code>, <code>noexec</code>, etc.</p>
<p>The full list of supported options can be found in
<a href="https://github.com/gokrazy/gokrazy/blob/main/mount.go#L26">https://github.com/gokrazy/gokrazy/blob/main/mount.go#L26</a></p>
<h2 id="update">Update</h2>
<p>The <code>Update</code> field contains a struct that configures how gokrazy updates are done.</p>
<p>You typically don’t need to configure the <code>Update</code> field.</p>
<h3 id="updatehostname">Update → Hostname</h3>
<p>Hostname (in UpdateStruct) overrides Struct.Hostname, but only for
deploying the update via HTTP, not in the generated image.</p>
<h3 id="updateusetls">Update → UseTLS</h3>
<p>The <code>UseTLS</code> field accepts the following values:</p>
<ul>
<li>empty (&quot;&quot;): use TLS if certificates already exist on disk</li>
<li><code>off</code>: disable TLS even if certificates exist</li>
<li><code>self-signed</code>: create (self-signed) TLS certificates if needed</li>
</ul>
<p>See <a href="/userguide/tls-for-untrusted-networks/">Using TLS in untrusted networks</a>
for more details.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;webserver&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Update&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;HTTPPassword&#34;</span>: <span style="color:#e6db74">&#34;secret&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;UseTLS&#34;</span>: <span style="color:#e6db74">&#34;self-signed&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="updatehttpport">Update → HTTPPort</h3>
<p>(Corresponds to the former <code>-http_port</code> gokr-packer flag.)</p>
<p>The <code>HTTPPort</code> field sets the HTTP port (port 80 by default) on which the
gokrazy web interface will be available. This field controls both: which port
your gokrazy instance listens on (server), and which port the <code>gok</code> CLI will use
for updating your instance (client).</p>
<p>It can be useful to configure a different port if you want to <a href="/packages/caddy-http-server/">run a web server
on port 80</a>, for example.</p>
<p>If <a href="#updateusetls"><code>UseTLS</code></a> is enabled, this field is ignored and
<a href="#updatehttpsport"><code>HTTPSPort</code></a> is used instead.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;webserver&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Update&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;HTTPPassword&#34;</span>: <span style="color:#e6db74">&#34;secret&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;HTTPPort&#34;</span>: <span style="color:#e6db74">&#34;1080&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="updatehttpsport">Update → HTTPSPort</h3>
<p>(Corresponds to the former <code>-https_port</code> gokr-packer flag.)</p>
<p>See <a href="#updatehttpport"><code>HTTPPort</code></a>, but <a href="#updateusetls">when TLS is enabled</a>
(default 443).</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;webserver&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Update&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;HTTPPassword&#34;</span>: <span style="color:#e6db74">&#34;secret&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;UseTLS&#34;</span>: <span style="color:#e6db74">&#34;self-signed&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;HTTPSPort&#34;</span>: <span style="color:#e6db74">&#34;8443&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="updatehttppassword">Update → HTTPPassword</h3>
<p>(Corresponds to the former <code>http-password.txt</code> host-specific config file.)</p>
<p>The <code>HTTPPassword</code> field configures the secret password that allows accessing
and updating your gokrazy instance.</p>
<p>When creating a new gokrazy instance (<code>gok new</code>), the <code>gok</code> CLI will create a
random password.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;webserver&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Update&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;HTTPPassword&#34;</span>: <span style="color:#e6db74">&#34;secret&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="updatecertpem">Update → CertPEM</h3>
<p>(Corresponds to the former <code>cert.pem</code> host-specific config file.)</p>
<p><a href="#updateusetls">When enabling TLS</a>, the <code>CertPEM</code> field allows you to use a
custom certificate file. This can be useful if you already have a certificate
setup for your environment (self-signed or otherwise).</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;webserver&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Update&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;HTTPPassword&#34;</span>: <span style="color:#e6db74">&#34;secret&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;CertPEM&#34;</span>: <span style="color:#e6db74">&#34;/home/michael/.ca/webservercert.pem&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;KeyPEM&#34;</span>: <span style="color:#e6db74">&#34;/home/michael/.ca/webserverkey.pem&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h3 id="updatekeypem">Update → KeyPEM</h3>
<p>(Corresponds to the former <code>key.pem</code> host-specific config file.)</p>
<p>Like <a href="#updatecertpem"><code>CertPEM</code></a>, but for the private key instead of the
certificate.</p>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1721548409"></script>
    <script src="/js/perfect-scrollbar.min.js?1721548409"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1721548409"></script>
    <script src="/js/jquery.sticky.js?1721548409"></script>
    <script src="/js/featherlight.min.js?1721548409"></script>
    <script src="/js/highlight.pack.js?1721548409"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1721548409"></script>
    <script src="/js/learn.js?1721548409"></script>
    <script src="/js/hugo-learn.js?1721548409"></script>
    
        
            <script src="/mermaid/mermaid.js?1721548409"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

