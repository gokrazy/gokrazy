<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.116.0-DEV">
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Tailscale VPN :: gokrazy</title>

    
    <link href="/css/nucleus.css?1743326640" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1743326640" rel="stylesheet">
    <link href="/css/hybrid.css?1743326640" rel="stylesheet">
    <link href="/css/featherlight.min.css?1743326640" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1743326640" rel="stylesheet">
    <link href="/css/auto-complete.css?1743326640" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1743326640" rel="stylesheet">
    <link href="/css/theme.css?1743326640" rel="stylesheet">
    <link href="/css/tabs.css?1743326640" rel="stylesheet">
    <link href="/css/hugo-theme.css?1743326640" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1743326640"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/packages/tailscale/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <img src="/logo.svg" width="100%" alt="gokrazy logo" title="gokrazy logo">

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1743326640"></script>
<script type="text/javascript" src="/js/auto-complete.js?1743326640"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/gokrazy.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1743326640"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/quickstart/" title="Quickstart" class="dd-item
        
        
        
        ">
      <a href="/quickstart/">
          <b>1. </b>Quickstart
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/platforms/" title="Supported platforms" class="dd-item
        
        
        
        ">
      <a href="/platforms/">
          <b>2. </b>Supported platforms
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/userguide/" title="Configuration" class="dd-item
        
        
        
        ">
      <a href="/userguide/">
          <b>3. </b>Configuration
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/userguide/instance-config/" title="Instance Config Reference" class="dd-item ">
        <a href="/userguide/instance-config/">
        Instance Config Reference
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/migration-guide/" title="Instance Config Migration Guide" class="dd-item ">
        <a href="/userguide/migration-guide/">
        Instance Config Migration Guide
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/automation/" title="Automation" class="dd-item ">
        <a href="/userguide/automation/">
        Automation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/package-config/" title="Package config: flags, environment variables, extra files" class="dd-item ">
        <a href="/userguide/package-config/">
        Flags, environment variables, â€¦
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/dhcp/" title="DHCP Client" class="dd-item ">
        <a href="/userguide/dhcp/">
        DHCP Client
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/remotesyslog/" title="Remote Syslog: sending gokrazy logs over the network" class="dd-item ">
        <a href="/userguide/remotesyslog/">
        Remote Syslog
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/wifi/" title="Connecting to WiFi networks" class="dd-item ">
        <a href="/userguide/wifi/">
        Connecting to WiFi
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/tls-for-untrusted-networks/" title="Using TLS in untrusted networks" class="dd-item ">
        <a href="/userguide/tls-for-untrusted-networks/">
        Using TLS in untrusted networks
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/bluetooth/" title="Using Bluetooth" class="dd-item ">
        <a href="/userguide/bluetooth/">
        Using Bluetooth
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/permanent-data/" title="Access permanent data" class="dd-item ">
        <a href="/userguide/permanent-data/">
        Access permanent data
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/qemu/" title="QEMU x86-64 virtual machine" class="dd-item ">
        <a href="/userguide/qemu/">
        QEMU x86-64 virtual machine
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/userguide/rsync-backups/" title="Permanent data backup with the gokrazy rsync" class="dd-item ">
        <a href="/userguide/rsync-backups/">
        Data backup with rsync
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/packages/" title="Available packages" class="dd-item
        parent
        
        
        ">
      <a href="/packages/">
          <b>4. </b>Available packages
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/packages/showcase/" title="Showcase" class="dd-item ">
        <a href="/packages/showcase/">
        Showcase
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/packages/tailscale/" title="Tailscale VPN" class="dd-item active">
        <a href="/packages/tailscale/">
        Tailscale VPN
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/packages/caddy-http-server/" title="Caddy HTTP server" class="dd-item ">
        <a href="/packages/caddy-http-server/">
        Caddy HTTP server
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/packages/minio/" title="MinIO object storage" class="dd-item ">
        <a href="/packages/minio/">
        MinIO object storage
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/packages/docker-containers/" title="Docker containers" class="dd-item ">
        <a href="/packages/docker-containers/">
        Docker containers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/packages/prometheus/" title="Prometheus" class="dd-item ">
        <a href="/packages/prometheus/">
        Prometheus
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/development/" title="Package development" class="dd-item
        
        
        
        ">
      <a href="/development/">
          <b>5. </b>Package development
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/development/process-interface/" title="Process interface / requirements" class="dd-item ">
        <a href="/development/process-interface/">
        Process interface / requirements
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/development/gpio/" title="Controlling a GPIO input/output pin" class="dd-item ">
        <a href="/development/gpio/">
        Input/output via GPIO pins
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/development/modules/" title="Working with Go modules" class="dd-item ">
        <a href="/development/modules/">
        Working with Go modules
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/development/buildtags/" title="The gokrazy Go build tag" class="dd-item ">
        <a href="/development/buildtags/">
        The gokrazy Go build tag
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/development/non-go/" title="Non-Go Prototyping" class="dd-item ">
        <a href="/development/non-go/">
        Non-Go Prototyping
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://github.com/gokrazy/gokrazy"><i class='fab fa-github'></i> GitHub repo</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/gokrazy/gokrazy/tree/master/website/content/packages/tailscale.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>gokrazy Go appliances</a> > <a href='/packages/'>Available packages</a> > Tailscale VPN
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#step-1-include-the-tailscale-packages">Step 1. include the tailscale packages</a></li>
    <li><a href="#step-2-set-command-line-flags">Step 2. set command-line flags</a></li>
    <li><a href="#step-3-authenticate-interactive-only">Step 3. authenticate (interactive only)</a></li>
    <li><a href="#step-4-disable-key-expiry-optional">Step 4. disable key expiry (optional)</a></li>
    <li><a href="#optional-using-gokrazy-as-a-tailscale-subnet-router">Optional: Using gokrazy as a Tailscale subnet router</a></li>
    <li><a href="#optional-accessing-gokrazy-using-tailscale-ssh">Optional: Accessing gokrazy using Tailscale SSH</a></li>
    <li><a href="#optional-tailscale-network-for-other-programs">Optional: Tailscale network for other programs</a></li>
    <li><a href="#optional-tailscale-go-listener">Optional: Tailscale Go listener</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Tailscale VPN
            </h1>
          

        


<p><a href="https://tailscale.com/">Tailscale</a>â€™s website reads:</p>
<blockquote>
<p>A secure network that just works</p>
<p>Zero config VPN. Installs on any device in minutes, manages firewall rules for you, and works from anywhere.</p>
</blockquote>
<p>gokrazy-based devices are no exception! This guide shows you how to use
Tailscale with gokrazy.</p>
<p>Tailscaleâ€™s networking will come in handy when accessing your gokrazy server
remotely (no static DHCP leases, port-forwarding and DynDNS required!), or even
to secure your communication when gokrazy is <a href="/userguide/unencrypted-wifi/">connected to an unencrypted WiFi
network</a>.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Package <code>tailscale.com</code> v1.56.1 or later (latest version used automatically unless you have the package already in go.mod)</li>
<li>Volume <code>/perm/</code> needs to be initialized (instructions use <code>github.com/gokrazy/mkfs</code> to initialize)
to persist authentication over reboots.</li>
</ul>
<h2 id="step-1-include-the-tailscale-packages">Step 1. include the tailscale packages</h2>
<p>Add the Tailscale daemon <code>tailscaled</code> and CLI <code>tailscale</code> Go packages to your
gokrazy instance:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gok add tailscale.com/cmd/tailscaled
</span></span><span style="display:flex;"><span>gok add tailscale.com/cmd/tailscale
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Automatically initialize a file system on the /perm partition on first boot:</span>
</span></span><span style="display:flex;"><span>gok add github.com/gokrazy/mkfs
</span></span></code></pre></div><h2 id="step-2-set-command-line-flags">Step 2. set command-line flags</h2>
<p>Then, open your instanceâ€™s <code>config.json</code> in your editor:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gok edit
</span></span></code></pre></div><p>And configure <a href="/userguide/package-config/#flags">Package config: Command-line
flags</a> for Option A or Option B:</p>
<p><strong>Option A: interactive authentication</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;ts&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tailscale.com/cmd/tailscaled&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tailscale.com/cmd/tailscale&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/mkfs&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;PackageConfig&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;tailscale.com/cmd/tailscale&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>            <span style="color:#f92672">&#34;CommandLineFlags&#34;</span>: [
</span></span><span style="display:flex; background-color:#3c3d38"><span>                <span style="color:#e6db74">&#34;up&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>            ]
</span></span><span style="display:flex; background-color:#3c3d38"><span>        }
</span></span><span style="display:flex; background-color:#3c3d38"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><strong>Option B: unattended authentication with auth key</strong></p>
<p>Alternatively,
navigate to <a href="https://login.tailscale.com/" title="Tailscale management console login.tailscale.com">Tailscale console</a> and open Settings / Keys. Generate auth key.</p>
<p>Include the key to tailscale flags:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;ts&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/fbstatus&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/hello&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/breakglass&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tailscale.com/cmd/tailscaled&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tailscale.com/cmd/tailscale&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/mkfs&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#f92672">&#34;PackageConfig&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>        <span style="color:#f92672">&#34;tailscale.com/cmd/tailscale&#34;</span>: {
</span></span><span style="display:flex; background-color:#3c3d38"><span>            <span style="color:#f92672">&#34;CommandLineFlags&#34;</span>: [
</span></span><span style="display:flex; background-color:#3c3d38"><span>                <span style="color:#e6db74">&#34;up&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>                <span style="color:#e6db74">&#34;--auth-key=tskey-AAAAAAAAAAAA-AAAAAAAAAAAAAAAAAAAAAA&#34;</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>            ]
</span></span><span style="display:flex; background-color:#3c3d38"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Then, deploy as usual:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gok update
</span></span></code></pre></div><h2 id="step-3-authenticate-interactive-only">Step 3. authenticate (interactive only)</h2>
<p>Skip this step if you are using option B with auth key.</p>
<ol>
<li>Navigate to your gokrazy web interface with browser using the URL displayed
by the <code>gok</code> CLI.</li>
<li>Open the service <code>/user/tailscale</code> and find the login URL.</li>
<li>Open the link with browser and log in to Tailscale and authorize the client.</li>
</ol>
<h2 id="step-4-disable-key-expiry-optional">Step 4. disable key expiry (optional)</h2>
<p>You are now connected to Tailscale and you can access your gokrazy instance
over Tailscale.</p>

<div class="notices note" ><p>Tailscale requires re-authentication periodically.
You can disable key expiry from <a href="https://login.tailscale.com/" title="Tailscale management console login.tailscale.com">Tailscale console</a> for the gokrazy
instance to not require login every 3 months.</p>
</div>

<h2 id="optional-using-gokrazy-as-a-tailscale-subnet-router">Optional: Using gokrazy as a Tailscale subnet router</h2>
<p>To allow hosts in your Tailnet to access devices in your network other
than your gokrazy appliance, you can set up Tailscale as a subnet router.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;ts&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tailscale.com/cmd/tailscaled&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tailscale.com/cmd/tailscale&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;PackageConfig&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tailscale.com/cmd/tailscale&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;CommandLineFlags&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;up&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>                <span style="color:#e6db74">&#34;--advertise-routes=192.168.0.0/24&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Starting <a href="https://github.com/tailscale/tailscale/issues/11405">Tailscale version v1.64</a>,
IP forwarding is automatically enabled on Gokrazy.</p>
<h2 id="optional-accessing-gokrazy-using-tailscale-ssh">Optional: Accessing gokrazy using Tailscale SSH</h2>
<p>To access the gokrazy appliance using SSH authenticating using Tailscale,
you can enable Tailscale SSH.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Hostname&#34;</span>: <span style="color:#e6db74">&#34;ts&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Packages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;github.com/gokrazy/serial-busybox&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tailscale.com/cmd/tailscaled&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;tailscale.com/cmd/tailscale&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;PackageConfig&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tailscale.com/cmd/tailscale&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;CommandLineFlags&#34;</span>: [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;up&#34;</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>                <span style="color:#e6db74">&#34;--ssh=true&#34;</span>
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Note that Tailscale SSH <a href="https://tailscale.com/kb/1193/tailscale-ssh#ensure-tailscale-ssh-is-permitted-in-acls">needs to be allowed by your Tailnet ACL</a>.
You can configure to allow, for example, each user to access their own
devices using Tailscale SSH, or define which hosts users can access.</p>
<h2 id="optional-tailscale-network-for-other-programs">Optional: Tailscale network for other programs</h2>
<p>Before Tailscale v1.56.1, Tailscale used <a href="https://tailscale.com/kb/1112/userspace-networking/" title="Userspace networking mode (for containers)">Userspace networking</a> mode on gokrazy,
meaning you needed to use Tailscale as an HTTP proxy to establish outgoing
connections into your tailnet.</p>
<p>With Tailscale v1.56.1 and newer, programs running on gokrazy can connect to
other devices in your tailnet without extra steps! ðŸŽ‰ DNS resolution and TCP
connections work out of the box.</p>
<h2 id="optional-tailscale-go-listener">Optional: Tailscale Go listener</h2>
<p>Before Tailscale v1.56.1, Tailscale used <a href="https://tailscale.com/kb/1112/userspace-networking/" title="Userspace networking mode (for containers)">Userspace networking</a> mode on gokrazy,
meaning you needed to use the tsnet package if you wanted to restrict a listener
to Tailscale.</p>
<p>With Tailscale v1.56.1 and newer, you can listen on Tailscale addresses and use
<a href="https://pkg.go.dev/tailscale.com/client/tailscale#LocalClient.WhoIs">LocalClient.WhoIs</a>
to obtain the remote identity:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;tailscale.com/client/tailscale&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">listen</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;listen&#34;</span>, <span style="color:#e6db74">&#34;gokrazy.monkey-turtle.ts.net:8111&#34;</span>, <span style="color:#e6db74">&#34;[host]:port listen address&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">allowedUser</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;allowed_user&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;the name of a tailscale user to allow&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;starting HTTP listener on %s&#34;</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">listen</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ts</span> <span style="color:#a6e22e">tailscale</span>.<span style="color:#a6e22e">LocalClient</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">httpsrv</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Server</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Addr</span>: <span style="color:#f92672">*</span><span style="color:#a6e22e">listen</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Handler</span>: <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">HandlerFunc</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">who</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ts</span>.<span style="color:#a6e22e">WhoIs</span>(<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Context</span>(), <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">RemoteAddr</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>(), <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusInternalServerError</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">who</span>.<span style="color:#a6e22e">UserProfile</span>.<span style="color:#a6e22e">LoginName</span> <span style="color:#f92672">!=</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">allowedUser</span> <span style="color:#f92672">||</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">allowedUser</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;you are logged in as %q (userprofile: %+v), but -allowed_user flag does not match!&#34;</span>, <span style="color:#a6e22e">who</span>.<span style="color:#a6e22e">UserProfile</span>.<span style="color:#a6e22e">LoginName</span>, <span style="color:#a6e22e">who</span>.<span style="color:#a6e22e">UserProfile</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;forbidden: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusForbidden</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;hey there, %q! this message is served via tailscale from gokrazy!&#34;</span>, <span style="color:#a6e22e">who</span>.<span style="color:#a6e22e">UserProfile</span>.<span style="color:#a6e22e">LoginName</span>)
</span></span><span style="display:flex;"><span>		}),
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">httpsrv</span>.<span style="color:#a6e22e">ListenAndServe</span>())
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol>
<li>Deploy this program to your gokrazy device</li>
<li>Open the listening address in your browser, e.g. <a href="http://gokrazy.monkey-turtle.ts.net:8111">http://gokrazy.monkey-turtle.ts.net:8111</a></li>
<li>Specify the <code>--allowed_user</code> flag to verify that tailscale authentication works as expected</li>
</ol>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1743326640"></script>
    <script src="/js/perfect-scrollbar.min.js?1743326640"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1743326640"></script>
    <script src="/js/jquery.sticky.js?1743326640"></script>
    <script src="/js/featherlight.min.js?1743326640"></script>
    <script src="/js/highlight.pack.js?1743326640"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1743326640"></script>
    <script src="/js/learn.js?1743326640"></script>
    <script src="/js/hugo-learn.js?1743326640"></script>
    
        
            <script src="/mermaid/mermaid.js?1743326640"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

